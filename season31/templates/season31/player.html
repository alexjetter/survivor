{% load staticfiles %}

<link rel="stylesheet" type="text/css" href="{% static 'season31/style.css' %}" />

<div class="marg0 pad0 thecontainer">

<div class="menu floatleft marg0">
	{% include "season31/menu.html" %}
	{% include "season31/leaderboard.html" %}
</div>
<div class="content floatleft marg0">

<div class="title">{{ player.user.username }}</div>
{% if player == user.player%}
<div>
	<form action="{% url 'season31:togglehelptext' player.id %}" method="post">
		{% csrf_token %}
		<input class="padtb0 padlr4" type="submit" value="{% if player.show_help_text %}Hide Help Text{% else %}Show Help Text{% endif %}" />
	</form>
</div>
{% endif %}

<div class="halfspacer"></div>

<table class="noborder">
	<tr>
		<td class="columnheader"></td>
		<td class="columnheader fggreen4">Team</td>
		<td class="columnheader"></td>
		<td class="columnheader fgred4">Vote Off Picks</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">LB</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">Action</td>
		<td class="columnheader fglightgrey">Vote Off</td>
		<td class="columnheader fglightgrey">JSP</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">Week</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">±</td>
		<td class="columnheader fglightgrey">Plc</td>
		<td class="columnheader fglightgrey">Score</td>
		<td class="columnheader"></td>
	</tr>
	{% for playerepisode in player.playerepisode_set.all %}
	{% if not playerepisode.episode.is_locked and player == user.player and playerepisode.episode = player.get_next_episode %}
	<tr>
		<td class="noborder padtb4" colspan=17></td>
	</tr>
	{% if player.show_help_text %}
	<tr>
		<td class="bglightgrey fgblack textleft pad8" colspan=17>Below are your picks for the next episode.  Your<span class="textbold">Team</span>is on the left and your<span class="textbold">Vote Off Predictions</span>are on the right.<br>You have until<span class="textbold">8:00 PM EST / 5:00 PST</span>to make your picks each week.<br>This form will automatically lock if you refresh after that.</td>
	</tr>
	{% endif %}
	<tr>
		<td class="bgblack textleft padtb8" colspan=17><span class="fgred2">{{ playerepisode.episode.time_to_lock }} left</span><span class="fglightgrey">to make changes to your picks</span></td>
	</tr>
	<tr>
		<td class="columnheader"></td>
		<td class="columnheader fggreen4">Team</td>
		<td class="columnheader"></td>
		<td class="columnheader fgred4">Vote Off Picks</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">LB</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">Action</td>
		<td class="columnheader fglightgrey">Vote Off</td>
		<td class="columnheader fglightgrey">JSP</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">Week</td>
		<td class="columnheader"></td>
		<td class="columnheader fglightgrey">±</td>
		<td class="columnheader fglightgrey">Plc</td>
		<td class="columnheader fglightgrey">Score</td>
		<td class="columnheader"></td>
	</tr>
	{% endif %}
	{% if playerepisode.episode.is_locked or player == user.player%}
	<tr>
		<td class="columnheader"><a href="{% url 'season31:episode' playerepisode.episode.id %}" class="fgwhite">{{ playerepisode.episode }}</a></td>

		<td class="pad0 marg0">
			{% for pick in playerepisode.get_team_picks %}
			<div class="bgtribe{{ pick.castaway_episode.tribe.color }} floatleft pad2 marg0 pickwidth">
				<a href="{% url 'season31:castaway' pick.castaway_episode.castaway.id %}" class="fgblack pad0 marg0 ">{{ pick.castaway_episode.castaway.name }}
				</a>
			</div>
			{% endfor %}
		</td>

		<td class="columnheader"></td>

		<td class="pad0 marg0">
			{% for pick in playerepisode.get_vote_picks %}
			<div class="bgtribe{{ pick.castaway_episode.tribe.color }} floatleft pad2 marg0 pickwidth">
				<a href="{% url 'season31:castaway' pick.castaway_episode.castaway.id %}" class="fgblack pad0 marg0 ">{{ pick.castaway_episode.castaway.name }}
				</a>
			</div>
			{% endfor %}
		</td>

		<td class="columnheader"></td>
		<td>{{ playerepisode.loyalty_bonus }}</td>
		<td class="columnheader"></td>
		<td>{{ playerepisode.action_score }}</td>
		<td>{{ playerepisode.vote_off_score }}</td>
		<td>{{ playerepisode.jsp_score }}</td>
		<td class="columnheader"></td>
		<td>{{ playerepisode.week_score }}</td>
		<td class="columnheader"></td>
		<td>{{ playerepisode.movement }}</td>
		<td>{{ playerepisode.place }}</td>
		<td>{{ playerepisode.total_score }}</td>
		<td class="columnheader"></td>
	</tr>
	{% else %}
	<tr>
		<td class="columnheader"><a href="{% url 'season31:episode' playerepisode.episode.id %}" class="fgwhite">{{ playerepisode.episode }}</a></td>
		<td class="textleft" colspan=15>Picks will be revealed in {{ playerepisode.episode.time_to_lock }}</td>
		<td class="columnheader"></td>
	</tr>
	{% endif %}
	{% endfor %}
	{% if user.player == player and not player.playerepisode_set.latest.episode.is_locked %}
	<!--
	<tr>
		<td class="bgwhite noborder"></td>
	</tr>
	-->
	<tr>
		<td class="bgblack" colspan=1></td>

		<td class="columnheader fggreen4 pad0 marg0">
			{% if player.get_latest_player_episode == player.playerepisode_set.latest%}
			<form action="{% url 'season31:pickteams' player.playerepisode_set.latest.id %}" method="post">
				{% csrf_token %}
				<div class="bgtribe{{ castawayepisode.tribe.color }} pad2 marg0">
					{% if player.playerepisode_set.latest.get_team_picks %}
					Pick New Team:
					{% else %}
					Pick {{ player.get_next_episode.team_size }} Team Members:
					{% endif %}
				</div>
				<table class="noborder width100">
				{% for castawayepisode in player.playerepisode_set.latest.get_pick_options %}
					<tr>
						<td class="bgtribe{{ castawayepisode.tribe.color }} textright noborder width45">
							<input type="checkbox" name="picks" id="{{ castawayepisode.id }}" value="{{ castawayepisode.castaway.name }}" />
						</td>
						<td class="bgtribe{{ castawayepisode.tribe.color }} textleft noborder width55">
							<label for="{{ castawayepisode.id }}">{{ castawayepisode.castaway }}</label>
						</td>
					</tr>
				{% endfor %}
				</table>
				<div>
					<input type="submit" value="Update Team" />
				</div>
			</form>
			{% if team_error_message %}
			<div class="bgred4">{{ team_error_message }}</div>
			{% endif %}
			{% endif %}
		</td>

		<td class="columnheader"></td>

		<td class="columnheader fgred4 pad0 marg0">
			{% if player.get_latest_player_episode == player.playerepisode_set.latest%}
			<form action="{% url 'season31:pickvotes' player.playerepisode_set.latest.id %}" method="post">
				{% csrf_token %}
				<div class="bgtribe{{ castawayepisode.tribe.color }} pad2 marg0">
					{% if player.playerepisode_set.latest.get_vote_picks %}
					Pick New Votes:
					{% else %}
					Pick 2 Votes:
					{% endif %}
				</div>
				<table class="noborder width100">
				{% for castawayepisode in player.playerepisode_set.latest.get_pick_options %}
					<tr>
						<td class="bgtribe{{ castawayepisode.tribe.color }} textright noborder width40">
							<input type="checkbox" name="picks" id="{{ castawayepisode.id }}" value="{{ castawayepisode.castaway.name }}" />
						</td>
						<td class="bgtribe{{ castawayepisode.tribe.color }} textleft noborder width60">
							<label for="{{ castawayepisode.id }}">{{ castawayepisode.castaway }}</label>
						</td>
					</tr>
				{% endfor %}
				</table>
				<div>
					<input type="submit" value="Update Votes" />
				</div>
			</form>
			{% if vote_error_message %}
			<div class="bgred4">{{ vote_error_message }}</div>
			{% endif %}
			{% endif %}
		</td>

		<td class="columnheader"></td>
		<td class="bgblack" colspan=12></td>
	</tr>
	{% endif %}
</table>

</div>

</div>